<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>é­‚ã®å›³æ›¸é¤¨ â€• ã‚ãªãŸã®ä¸­ã®ç‰©èªã‚’æ¢ã›</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Zen+Old+Mincho:wght@400;700;900&family=Shippori+Mincho:wght@400;600;800&family=Kiwi+Maru:wght@300;400;500&family=Yuji+Boku&display=swap" rel="stylesheet">
<style>
:root {
  --parchment: #F5E6C8;
  --parchment-dark: #E8D5AB;
  --ink: #3B2F2F;
  --ink-light: #6B5B4B;
  --gold: #C9A84C;
  --gold-bright: #E8C95A;
  --fire: #E85D4A;
  --root: #5BA37A;
  --wind: #4A8DB7;
  --water: #6BB5A0;
  --light: #E8C44A;
  --cover: #8B2500;
  --cover-dark: #5C1A00;
  --spine: #6B1B00;
  --page-shadow: rgba(59, 47, 47, 0.15);
  --transition-page: 0.8s cubic-bezier(0.4, 0, 0.2, 1);
}

* { margin: 0; padding: 0; box-sizing: border-box; }

html, body {
  height: 100%;
  overflow: hidden;
  background: #2A1F1A;
  font-family: 'Shippori Mincho', serif;
  color: var(--ink);
  -webkit-tap-highlight-color: transparent;
  user-select: none;
}

/* ===== BOOK CONTAINER ===== */
.book-world {
  width: 100%;
  height: 100%;
  display: flex;
  align-items: center;
  justify-content: center;
  background: radial-gradient(ellipse at 50% 40%, #3D2B1F 0%, #1A110C 100%);
  perspective: 1200px;
}

/* Library background image */
.book-world::before {
  content: '';
  position: fixed;
  top: 0; left: 0; right: 0; bottom: 0;
  background: url('assets/ui/bg_library.png') center/cover no-repeat;
  opacity: 0.25;
  pointer-events: none;
  z-index: 0;
}

/* ===== SCREENS ===== */
.screen {
  position: absolute;
  width: 100%;
  height: 100%;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.6s ease;
  z-index: 1;
}

.screen.active {
  opacity: 1;
  pointer-events: auto;
}

/* ===== COVER SCREEN ===== */
.cover-screen {
  justify-content: center;
  padding: 24px;
}

.book-cover {
  width: min(90vw, 380px);
  aspect-ratio: 3/4;
  background: linear-gradient(135deg, var(--cover) 0%, var(--cover-dark) 100%);
  border-radius: 4px 16px 16px 4px;
  position: relative;
  box-shadow:
    -4px 0 0 var(--spine),
    -6px 2px 0 rgba(0,0,0,0.3),
    0 8px 32px rgba(0,0,0,0.5),
    inset 0 0 60px rgba(0,0,0,0.3);
  cursor: pointer;
  transition: transform 0.4s ease, box-shadow 0.4s ease;
  animation: bookFloat 4s ease-in-out infinite;
  overflow: hidden;
}

/* Cover book image overlay */
.book-cover::after {
  content: '';
  position: absolute;
  top: 0; left: 0; right: 0; bottom: 0;
  background: url('assets/ui/cover_book.png') center/cover no-repeat;
  opacity: 0.5;
  mix-blend-mode: screen;
  border-radius: inherit;
}

.book-cover:hover, .book-cover:active {
  transform: scale(1.02) rotateY(-3deg);
  box-shadow:
    -4px 0 0 var(--spine),
    -6px 2px 0 rgba(0,0,0,0.3),
    0 12px 48px rgba(0,0,0,0.6),
    inset 0 0 60px rgba(0,0,0,0.3);
}

@keyframes bookFloat {
  0%, 100% { transform: translateY(0); }
  50% { transform: translateY(-8px); }
}

.cover-ornament {
  position: absolute;
  top: 0; left: 0; right: 0; bottom: 0;
  border: 3px solid var(--gold);
  margin: 16px;
  border-radius: 2px 12px 12px 2px;
  opacity: 0.7;
  z-index: 2;
}

.cover-ornament::before, .cover-ornament::after {
  content: 'âœ¦';
  position: absolute;
  color: var(--gold);
  font-size: 18px;
}

.cover-ornament::before { top: -10px; left: 50%; transform: translateX(-50%); }
.cover-ornament::after { bottom: -10px; left: 50%; transform: translateX(-50%); }

.cover-content {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
  width: 80%;
  z-index: 2;
}

.cover-icon {
  font-size: 52px;
  margin-bottom: 16px;
  filter: drop-shadow(0 2px 8px rgba(0,0,0,0.3));
  animation: iconGlow 3s ease-in-out infinite;
}

@keyframes iconGlow {
  0%, 100% { filter: drop-shadow(0 2px 8px rgba(201, 168, 76, 0.3)); }
  50% { filter: drop-shadow(0 2px 16px rgba(201, 168, 76, 0.6)); }
}

.cover-title {
  font-family: 'Zen Old Mincho', serif;
  font-weight: 900;
  font-size: 28px;
  color: var(--gold-bright);
  line-height: 1.5;
  text-shadow: 0 2px 8px rgba(0,0,0,0.7);
  margin-bottom: 12px;
  letter-spacing: 0.1em;
}

.cover-subtitle {
  font-family: 'Kiwi Maru', serif;
  font-size: 13px;
  color: rgba(232, 201, 90, 0.8);
  line-height: 1.8;
  letter-spacing: 0.05em;
  text-shadow: 0 1px 4px rgba(0,0,0,0.6);
}

.cover-tap {
  position: absolute;
  bottom: 32px;
  left: 50%;
  transform: translateX(-50%);
  font-family: 'Kiwi Maru', serif;
  font-size: 12px;
  color: rgba(232, 201, 90, 0.5);
  animation: tapPulse 2s ease-in-out infinite;
  letter-spacing: 0.1em;
  z-index: 2;
}

@keyframes tapPulse {
  0%, 100% { opacity: 0.4; }
  50% { opacity: 0.9; }
}

/* ===== INTRO SCREEN ===== */
.page-screen {
  background: var(--parchment);
  padding: 0;
}

.page-inner {
  width: 100%;
  height: 100%;
  overflow-y: auto;
  -webkit-overflow-scrolling: touch;
  padding: 32px 24px;
  position: relative;
  /* Parchment background texture */
  background: url('assets/ui/bg_parchment.png') center/cover repeat;
}

.page-inner::before {
  content: '';
  position: absolute;
  top: 0; left: 0; right: 0; bottom: 0;
  background: rgba(245, 230, 200, 0.75);
  pointer-events: none;
  z-index: 0;
}

.page-inner > * { position: relative; z-index: 1; }

.page-edge {
  position: fixed;
  top: 0;
  left: 0;
  width: 6px;
  height: 100%;
  background: linear-gradient(to right, rgba(0,0,0,0.12), transparent);
  z-index: 10;
  pointer-events: none;
}

/* ===== INTRO ===== */
.intro-illustration {
  width: 100%;
  max-width: 320px;
  margin: 0 auto 24px;
  border-radius: 12px;
  position: relative;
  overflow: hidden;
  box-shadow: 0 4px 24px rgba(0,0,0,0.2);
}

.intro-illustration img {
  width: 100%;
  height: auto;
  display: block;
}

.librarian-container {
  width: 120px;
  margin: 0 auto 20px;
  position: relative;
}

.librarian-container img {
  width: 100%;
  height: auto;
  display: block;
  filter: drop-shadow(0 4px 12px rgba(0,0,0,0.2));
}

.chapter-num {
  font-family: 'Yuji Boku', serif;
  font-size: 14px;
  color: var(--gold);
  text-align: center;
  margin-bottom: 8px;
  letter-spacing: 0.2em;
}

.page-title {
  font-family: 'Zen Old Mincho', serif;
  font-weight: 900;
  font-size: 22px;
  text-align: center;
  color: var(--ink);
  margin-bottom: 20px;
  line-height: 1.6;
}

.page-divider {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 12px;
  margin: 16px 0;
  color: var(--gold);
  font-size: 10px;
  opacity: 0.6;
}

.page-divider::before, .page-divider::after {
  content: '';
  flex: 1;
  height: 1px;
  background: linear-gradient(to right, transparent, var(--gold), transparent);
}

.narrative-text {
  font-family: 'Kiwi Maru', serif;
  font-weight: 400;
  font-size: 15px;
  line-height: 2;
  color: var(--ink-light);
  text-align: center;
  margin-bottom: 24px;
  letter-spacing: 0.02em;
}

.narrative-text .highlight {
  color: var(--ink);
  font-weight: 500;
}

/* ===== STORY ILLUSTRATION ===== */
.story-illustration {
  width: 100%;
  max-width: 340px;
  margin: 0 auto 20px;
  border-radius: 12px;
  position: relative;
  overflow: hidden;
  box-shadow: 0 4px 20px rgba(0,0,0,0.15);
  background: #2A1F1A;
}

.story-illustration img {
  width: 100%;
  height: auto;
  display: block;
  border-radius: 12px;
  position: relative;
  z-index: 2;
}

.story-illustration .scene-bg {
  position: absolute;
  top: 0; left: 0; right: 0; bottom: 0;
}

.story-illustration .scene-emoji {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  font-size: 48px;
  display: none; /* Hidden when image is available */
}

/* Fallback: show emoji only if image fails */
.story-illustration.no-image .scene-emoji {
  display: block;
}

.story-illustration.no-image .scene-bg {
  display: block;
}

.story-illustration.no-image img {
  display: none;
}

/* ===== CHOICES ===== */
.choices-container {
  width: 100%;
  max-width: 380px;
  margin: 0 auto;
  display: flex;
  flex-direction: column;
  gap: 12px;
  padding-bottom: 32px;
}

.choice-btn {
  width: 100%;
  padding: 16px 20px;
  background: rgba(255, 255, 255, 0.6);
  border: 2px solid rgba(201, 168, 76, 0.3);
  border-radius: 12px;
  font-family: 'Kiwi Maru', serif;
  font-size: 14px;
  line-height: 1.7;
  color: var(--ink);
  cursor: pointer;
  transition: all 0.3s ease;
  text-align: left;
  display: flex;
  align-items: flex-start;
  gap: 12px;
  position: relative;
  overflow: hidden;
}

.choice-btn::before {
  content: '';
  position: absolute;
  top: 0; left: 0; right: 0; bottom: 0;
  background: linear-gradient(135deg, rgba(201, 168, 76, 0.1), transparent);
  opacity: 0;
  transition: opacity 0.3s ease;
}

.choice-btn:hover::before, .choice-btn:active::before {
  opacity: 1;
}

.choice-btn:active {
  transform: scale(0.98);
  border-color: var(--gold);
  box-shadow: 0 0 16px rgba(201, 168, 76, 0.2);
}

.choice-letter {
  flex-shrink: 0;
  width: 28px;
  height: 28px;
  background: var(--gold);
  color: white;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-family: 'Zen Old Mincho', serif;
  font-weight: 700;
  font-size: 13px;
}

.choice-btn.selected {
  background: rgba(201, 168, 76, 0.15);
  border-color: var(--gold);
  box-shadow: 0 0 20px rgba(201, 168, 76, 0.15);
}

/* ===== FEEDBACK ===== */
.feedback-overlay {
  position: fixed;
  top: 0; left: 0; right: 0; bottom: 0;
  background: rgba(245, 230, 200, 0.95);
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 32px;
  z-index: 100;
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.5s ease;
}

.feedback-overlay.show {
  opacity: 1;
  pointer-events: auto;
}

.feedback-icon {
  font-size: 48px;
  margin-bottom: 20px;
  animation: feedbackPop 0.5s ease;
}

@keyframes feedbackPop {
  0% { transform: scale(0); }
  60% { transform: scale(1.2); }
  100% { transform: scale(1); }
}

.feedback-text {
  font-family: 'Kiwi Maru', serif;
  font-size: 15px;
  line-height: 2;
  color: var(--ink-light);
  text-align: center;
  max-width: 300px;
  margin-bottom: 32px;
}

.next-btn {
  padding: 14px 48px;
  background: var(--gold);
  color: white;
  border: none;
  border-radius: 28px;
  font-family: 'Kiwi Maru', serif;
  font-size: 15px;
  cursor: pointer;
  transition: all 0.3s ease;
  box-shadow: 0 4px 16px rgba(201, 168, 76, 0.3);
}

.next-btn:active {
  transform: scale(0.95);
  box-shadow: 0 2px 8px rgba(201, 168, 76, 0.3);
}

/* ===== PROGRESS BAR ===== */
.progress-bar {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  height: 4px;
  background: rgba(0,0,0,0.05);
  z-index: 50;
}

.progress-fill {
  height: 100%;
  background: linear-gradient(90deg, var(--gold), var(--gold-bright));
  transition: width 0.6s ease;
  border-radius: 0 2px 2px 0;
}

/* ===== START BUTTON ===== */
.start-btn {
  display: inline-flex;
  align-items: center;
  gap: 8px;
  padding: 16px 40px;
  background: linear-gradient(135deg, var(--cover), var(--cover-dark));
  color: var(--gold-bright);
  border: 2px solid var(--gold);
  border-radius: 28px;
  font-family: 'Zen Old Mincho', serif;
  font-size: 16px;
  cursor: pointer;
  transition: all 0.3s ease;
  box-shadow: 0 4px 20px rgba(139, 37, 0, 0.3);
  letter-spacing: 0.1em;
}

.start-btn:active {
  transform: scale(0.95);
}

/* ===== RESULT SCREEN ===== */
.result-inner {
  width: 100%;
  height: 100%;
  overflow-y: auto;
  -webkit-overflow-scrolling: touch;
  padding: 40px 24px 60px;
  background: url('assets/ui/bg_parchment.png') center/cover repeat;
  position: relative;
}

.result-inner::before {
  content: '';
  position: absolute;
  top: 0; left: 0; right: 0; bottom: 0;
  background: rgba(245, 230, 200, 0.7);
  pointer-events: none;
}

.result-inner > * { position: relative; z-index: 1; }

.result-type-image {
  width: 200px;
  height: 200px;
  margin: 0 auto 20px;
  border-radius: 50%;
  overflow: hidden;
  box-shadow: 0 8px 32px rgba(0,0,0,0.2), 0 0 0 4px var(--gold), 0 0 0 8px rgba(201,168,76,0.2);
}

.result-type-image img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.result-header-icon {
  font-size: 56px;
  text-align: center;
  margin-bottom: 16px;
  animation: feedbackPop 0.8s ease;
}

.result-label {
  font-family: 'Yuji Boku', serif;
  font-size: 13px;
  color: var(--gold);
  text-align: center;
  letter-spacing: 0.3em;
  margin-bottom: 8px;
}

.result-type-name {
  font-family: 'Zen Old Mincho', serif;
  font-weight: 900;
  font-size: 24px;
  text-align: center;
  color: var(--ink);
  margin-bottom: 4px;
  line-height: 1.5;
}

.result-type-en {
  font-family: 'Kiwi Maru', serif;
  font-size: 12px;
  color: var(--ink-light);
  text-align: center;
  margin-bottom: 24px;
  letter-spacing: 0.05em;
}

/* Radar Chart */
.radar-container {
  width: 100%;
  max-width: 360px;
  margin: 0 auto 36px;
  padding: 8px;
  background: rgba(255,255,255,0.3);
  border-radius: 20px;
  border: 1px solid rgba(201, 168, 76, 0.15);
}

.radar-container svg {
  width: 100%;
  height: auto;
}

/* Score Bars */
.score-section {
  margin-bottom: 28px;
}

.score-section-title {
  font-family: 'Zen Old Mincho', serif;
  font-size: 16px;
  color: var(--ink);
  margin-bottom: 16px;
  text-align: center;
}

.score-item {
  display: flex;
  align-items: center;
  gap: 10px;
  margin-bottom: 12px;
}

.score-icon { font-size: 20px; flex-shrink: 0; }
.score-name {
  font-family: 'Kiwi Maru', serif;
  font-size: 13px;
  color: var(--ink-light);
  width: 28px;
  flex-shrink: 0;
}

.score-bar-bg {
  flex: 1;
  height: 14px;
  background: rgba(0,0,0,0.06);
  border-radius: 7px;
  overflow: hidden;
}

.score-bar-fill {
  height: 100%;
  border-radius: 7px;
  transition: width 1.2s cubic-bezier(0.4, 0, 0.2, 1);
  width: 0;
}

.score-value {
  font-family: 'Kiwi Maru', serif;
  font-size: 12px;
  color: var(--ink-light);
  width: 32px;
  text-align: right;
  flex-shrink: 0;
}

/* Type Description */
.type-description {
  background: rgba(255,255,255,0.5);
  border: 1px solid rgba(201, 168, 76, 0.2);
  border-radius: 16px;
  padding: 24px;
  margin-bottom: 24px;
}

.type-desc-text {
  font-family: 'Kiwi Maru', serif;
  font-size: 14px;
  line-height: 2;
  color: var(--ink-light);
  text-align: center;
}

.type-traits {
  display: flex;
  flex-direction: column;
  gap: 16px;
  margin-top: 20px;
}

.trait-group-title {
  font-family: 'Zen Old Mincho', serif;
  font-size: 14px;
  color: var(--ink);
  margin-bottom: 6px;
}

.trait-tags {
  display: flex;
  flex-wrap: wrap;
  gap: 6px;
}

.trait-tag {
  padding: 4px 12px;
  border-radius: 16px;
  font-family: 'Kiwi Maru', serif;
  font-size: 12px;
}

.trait-tag.strength {
  background: rgba(91, 163, 122, 0.15);
  color: var(--root);
  border: 1px solid rgba(91, 163, 122, 0.3);
}

.trait-tag.weakness {
  background: rgba(232, 93, 74, 0.1);
  color: var(--fire);
  border: 1px solid rgba(232, 93, 74, 0.2);
}

/* AI Advice */
.advice-section {
  background: linear-gradient(135deg, rgba(74, 141, 183, 0.08), rgba(107, 181, 160, 0.08));
  border: 1px solid rgba(74, 141, 183, 0.2);
  border-radius: 16px;
  padding: 24px;
  margin-bottom: 24px;
}

.advice-title {
  font-family: 'Zen Old Mincho', serif;
  font-size: 15px;
  color: var(--wind);
  margin-bottom: 12px;
}

.advice-text {
  font-family: 'Kiwi Maru', serif;
  font-size: 13px;
  line-height: 1.9;
  color: var(--ink-light);
}

/* Archetype */
.archetype-badge {
  display: inline-block;
  padding: 6px 20px;
  background: rgba(201, 168, 76, 0.12);
  border: 1px solid rgba(201, 168, 76, 0.3);
  border-radius: 20px;
  font-family: 'Yuji Boku', serif;
  font-size: 13px;
  color: var(--gold);
  margin-bottom: 20px;
}

/* Retry */
.retry-btn {
  display: inline-flex;
  align-items: center;
  gap: 8px;
  padding: 14px 36px;
  background: transparent;
  color: var(--ink-light);
  border: 2px solid rgba(59, 47, 47, 0.2);
  border-radius: 28px;
  font-family: 'Kiwi Maru', serif;
  font-size: 14px;
  cursor: pointer;
  transition: all 0.3s ease;
  margin-top: 8px;
}

.retry-btn:active {
  transform: scale(0.95);
  border-color: var(--gold);
  color: var(--ink);
}

/* ===== PAGE TRANSITION ===== */
.page-turn-enter {
  animation: pageTurnIn 0.7s ease forwards;
}

@keyframes pageTurnIn {
  from {
    opacity: 0;
    transform: translateX(40px);
  }
  to {
    opacity: 1;
    transform: translateX(0);
  }
}

/* ===== VIDEO SCREEN ===== */
.video-overlay {
  position: fixed;
  top: 0; left: 0; right: 0; bottom: 0;
  background: #0A0706;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  z-index: 150;
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.5s ease;
}

.video-overlay.show {
  opacity: 1;
  pointer-events: auto;
}

.video-overlay video {
  width: 100%;
  height: 100%;
  object-fit: contain;
  background: #0A0706;
}

.video-skip-btn {
  position: absolute;
  bottom: 32px;
  right: 24px;
  padding: 8px 20px;
  background: rgba(255,255,255,0.15);
  backdrop-filter: blur(8px);
  -webkit-backdrop-filter: blur(8px);
  border: 1px solid rgba(255,255,255,0.2);
  border-radius: 20px;
  font-family: 'Kiwi Maru', serif;
  font-size: 12px;
  color: rgba(255,255,255,0.7);
  cursor: pointer;
  transition: all 0.3s ease;
  z-index: 10;
}

.video-skip-btn:active {
  background: rgba(255,255,255,0.3);
  color: #fff;
}

.video-chapter-label {
  position: absolute;
  top: 24px;
  left: 50%;
  transform: translateX(-50%);
  font-family: 'Yuji Boku', serif;
  font-size: 13px;
  color: rgba(201, 168, 76, 0.8);
  letter-spacing: 0.2em;
  text-shadow: 0 1px 4px rgba(0,0,0,0.8);
  z-index: 10;
  opacity: 0;
  animation: fadeIn 1s ease 0.5s forwards;
}

/* ===== LOADING SCREEN ===== */
.loading-screen {
  position: fixed;
  top: 0; left: 0; right: 0; bottom: 0;
  background: var(--parchment);
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  z-index: 200;
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.5s ease;
}

.loading-screen.show {
  opacity: 1;
  pointer-events: auto;
}

.loading-librarian {
  width: 120px;
  height: auto;
  margin-bottom: 20px;
  animation: loadingFloat 2s ease-in-out infinite;
  filter: drop-shadow(0 4px 12px rgba(0,0,0,0.15));
}

@keyframes loadingFloat {
  0%, 100% { transform: translateY(0); }
  50% { transform: translateY(-10px); }
}

.loading-book {
  font-size: 48px;
  animation: loadingFlip 1.5s ease-in-out infinite;
  margin-bottom: 20px;
}

@keyframes loadingFlip {
  0%, 100% { transform: rotateY(0deg); }
  50% { transform: rotateY(180deg); }
}

.loading-text {
  font-family: 'Kiwi Maru', serif;
  font-size: 14px;
  color: var(--ink-light);
  animation: tapPulse 2s ease-in-out infinite;
}

/* ===== SHARE CARD ===== */
.share-section {
  text-align: center;
  padding: 20px 0 40px;
}

.share-card {
  width: 100%;
  max-width: 320px;
  margin: 0 auto 20px;
  background: linear-gradient(135deg, var(--cover), var(--cover-dark));
  border-radius: 16px;
  padding: 28px 24px;
  color: var(--gold-bright);
  box-shadow: 0 8px 32px rgba(0,0,0,0.2);
  position: relative;
  overflow: hidden;
}

.share-card::before {
  content: '';
  position: absolute;
  top: 0; left: 0; right: 0; bottom: 0;
  background: url('assets/ui/bg_parchment.png') center/cover;
  opacity: 0.08;
}

.share-card > * { position: relative; z-index: 1; }

.share-card-title {
  font-family: 'Zen Old Mincho', serif;
  font-size: 12px;
  letter-spacing: 0.2em;
  opacity: 0.7;
  margin-bottom: 8px;
}

.share-card-type {
  font-family: 'Zen Old Mincho', serif;
  font-weight: 900;
  font-size: 20px;
  margin-bottom: 12px;
  line-height: 1.5;
}

.share-card-params {
  display: flex;
  justify-content: center;
  gap: 16px;
  font-family: 'Kiwi Maru', serif;
  font-size: 11px;
  opacity: 0.7;
}

/* Animations */
.fade-in { animation: fadeIn 0.6s ease forwards; }
.fade-in-up { animation: fadeInUp 0.6s ease forwards; }

@keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
@keyframes fadeInUp {
  from { opacity: 0; transform: translateY(20px); }
  to { opacity: 1; transform: translateY(0); }
}

.delay-1 { animation-delay: 0.1s; opacity: 0; }
.delay-2 { animation-delay: 0.2s; opacity: 0; }
.delay-3 { animation-delay: 0.3s; opacity: 0; }
.delay-4 { animation-delay: 0.4s; opacity: 0; }
.delay-5 { animation-delay: 0.5s; opacity: 0; }
.delay-6 { animation-delay: 0.6s; opacity: 0; }
</style>
</head>
<body>

<div class="book-world" id="app">

  <!-- COVER SCREEN -->
  <div class="screen cover-screen" id="coverScreen">
    <div class="book-cover" onclick="openBook()">
      <div class="cover-ornament"></div>
      <div class="cover-content">
        <div class="cover-icon">ğŸ“–</div>
        <div class="cover-title">é­‚ã®å›³æ›¸é¤¨</div>
        <div class="cover-subtitle">
          ã‚ãªãŸã®ä¸­ã®<br>ç‰©èªã‚’æ¢ã›
        </div>
      </div>
      <div class="cover-tap">â€• ã‚¿ãƒƒãƒ—ã—ã¦é–‹ã â€•</div>
    </div>
  </div>

  <!-- INTRO SCREEN -->
  <div class="screen page-screen" id="introScreen">
    <div class="page-edge"></div>
    <div class="page-inner">
      <div class="intro-illustration">
        <img src="assets/ui/bg_library.png" alt="é­‚ã®å›³æ›¸é¤¨">
      </div>

      <div class="librarian-container">
        <img src="assets/ui/librarian_character.png" alt="å¸æ›¸">
      </div>

      <div class="chapter-num">â€• åºç«  â€•</div>
      <div class="page-title">è¿·å­ã®ç‰©èªã®ä¸»äººå…¬</div>
      <div class="page-divider">âœ¦</div>

      <div class="narrative-text">
        ã‚ã‚‹æ—¥ã€ã‚ãªãŸã¯<br>
        å¤ã„<span class="highlight">å›³æ›¸é¤¨</span>ã§ç›®ã‚’è¦šã¾ã—ã¾ã—ãŸã€‚<br><br>
        ç›®ã®å‰ã«ã¯ã€ç™½é«ªã®<span class="highlight">å¸æ›¸</span>ãŒ<br>
        å„ªã—ãå¾®ç¬‘ã‚“ã§ã„ã¾ã™ã€‚<br><br>
        ã€Œã‚ˆã†ã“ãã€<span class="highlight">é­‚ã®å›³æ›¸é¤¨</span>ã¸ã€‚<br>
        ã‚ãªãŸã¯ã©ã†ã‚„ã‚‰ã€<br>
        è‡ªåˆ†ã®ç‰©èªã‚’è¦‹å¤±ã£ãŸã‚ˆã†ã§ã™ã­ã€‚ã€<br><br>
        ã€Œã“ã‚Œã‹ã‚‰<span class="highlight">10ã®æ˜”è©±</span>ã‚’å·¡ã‚Šã€<br>
        ã‚ãªãŸã®ä¸­ã«çœ ã‚‹<br>
        <span class="highlight">æœ¬å½“ã®ç‰©èª</span>ã‚’<br>
        ä¸€ç·’ã«æ¢ã—ã¾ã—ã‚‡ã†ã€‚ã€
      </div>

      <div style="text-align: center; padding-bottom: 24px;">
        <button class="start-btn" onclick="startDiagnosis()">
          ç‰©èªã‚’å§‹ã‚ã‚‹ âœ¦
        </button>
      </div>
    </div>
  </div>

  <!-- STORY SCREEN -->
  <div class="screen page-screen" id="storyScreen">
    <div class="progress-bar"><div class="progress-fill" id="progressFill"></div></div>
    <div class="page-edge"></div>
    <div class="page-inner" id="storyContent">
      <!-- Dynamically rendered -->
    </div>
  </div>

  <!-- FEEDBACK OVERLAY -->
  <div class="feedback-overlay" id="feedbackOverlay">
    <div class="feedback-icon" id="feedbackIcon">âœ¨</div>
    <div class="feedback-text" id="feedbackText"></div>
    <button class="next-btn" id="nextBtn" onclick="nextStory()">æ¬¡ã®ç‰©èªã¸ â–¸</button>
  </div>

  <!-- VIDEO OVERLAY -->
  <div class="video-overlay" id="videoOverlay">
    <div class="video-chapter-label" id="videoChapterLabel"></div>
    <video id="storyVideo" playsinline webkit-playsinline></video>
    <button class="video-skip-btn" id="videoSkipBtn" onclick="skipVideo()">ã‚¹ã‚­ãƒƒãƒ— â–¸</button>
  </div>

  <!-- LOADING SCREEN -->
  <div class="loading-screen" id="loadingScreen">
    <img src="assets/ui/librarian_character.png" alt="å¸æ›¸" class="loading-librarian">
    <div class="loading-text">ã‚ãªãŸã®ç‰©èªã‚’ç´è§£ã„ã¦ã„ã¾ã™â€¦</div>
  </div>

  <!-- RESULT SCREEN -->
  <div class="screen page-screen" id="resultScreen">
    <div class="page-edge"></div>
    <div class="result-inner" id="resultContent">
      <!-- Dynamically rendered -->
    </div>
  </div>

</div>

<script>
// ===== IMAGE PATH HELPERS =====
function storyImagePath(num) {
  return `assets/illustrations/stories/story_${String(num).padStart(2,'0')}_base.png`;
}

function typeImagePath(primary, secondary) {
  return `assets/illustrations/types/type_${primary}_${secondary}.png`;
}

function badgePath(primary, secondary, size) {
  size = size || 'lg';
  return `assets/badges/badge_${primary}_${secondary}_${size}.png`;
}

function storyVideoPath(num) {
  return `assets/illustrations/movie/st${String(num).padStart(2,'0')}.mp4`;
}

// ===== INTRO VIDEO (st00) =====
function playIntroVideo() {
  videoPlaying = true;
  const overlay = document.getElementById('videoOverlay');
  const video = document.getElementById('storyVideo');
  const label = document.getElementById('videoChapterLabel');
  const skipBtn = document.getElementById('videoSkipBtn');

  label.textContent = '';
  label.style.opacity = '0';
  skipBtn.style.display = 'block';

  video.src = storyVideoPath(0);
  video.currentTime = 0;
  video.muted = false;

  overlay.classList.add('show');

  video.play().catch(() => {
    video.muted = true;
    video.play().catch(() => {
      finishIntroVideo();
    });
  });

  video.onended = () => { finishIntroVideo(); };
  video.onerror = () => { finishIntroVideo(); };

  // ã‚¹ã‚­ãƒƒãƒ—ãƒœã‚¿ãƒ³ã‚’ä¸€æ™‚çš„ã«ã‚¤ãƒ³ãƒˆãƒ­ç”¨ã«å·®ã—æ›¿ãˆ
  skipBtn.onclick = () => { skipIntroVideo(); };
}

function skipIntroVideo() {
  const video = document.getElementById('storyVideo');
  video.pause();
  video.onended = null;
  video.onerror = null;
  finishIntroVideo();
}

function finishIntroVideo() {
  if (!videoPlaying) return;
  videoPlaying = false;

  const overlay = document.getElementById('videoOverlay');
  const video = document.getElementById('storyVideo');
  const skipBtn = document.getElementById('videoSkipBtn');

  video.onended = null;
  video.onerror = null;

  overlay.classList.remove('show');

  setTimeout(() => {
    video.pause();
    video.removeAttribute('src');
    // ã‚¹ã‚­ãƒƒãƒ—ãƒœã‚¿ãƒ³ã‚’é€šå¸¸ã«æˆ»ã™
    skipBtn.onclick = () => { skipVideo(); };
    // è¡¨ç´™ã‚’è¡¨ç¤º
    showScreen('coverScreen');
  }, 500);
}

// ===== DATA =====
const STORIES = [
  {
    number: 1,
    title: 'æ—…ç«‹ã¡ã®æœ',
    theme: 'å®‰å…¨åœ vs æœªçŸ¥ã¸ã®æ¬²æ±‚',
    emoji: 'ğŸŒ…',
    bgGradient: 'linear-gradient(135deg, #FF9A56 0%, #FF6B6B 50%, #C44569 100%)',
    narrative: 'å¤œæ˜ã‘å‰ã«ç›®ãŒè¦šã‚ã¾ã—ãŸã€‚\nä»Šæ—¥ã¯é•·ã„æ—…ã®å§‹ã¾ã‚Šã®æ—¥ã€‚\nçª“ã®å¤–ã«ã¯ã€ã¾ã è¦‹ã¬ä¸–ç•ŒãŒ\næœéœ§ã®å‘ã“ã†ã«åºƒãŒã£ã¦ã„ã¾ã™ã€‚\n\nã‚ãªãŸã¯ã©ã®ã‚ˆã†ã«æ—…ç«‹ã¡ã¾ã™ã‹ï¼Ÿ',
    choices: [
      { letter: 'A', text: 'æº–å‚™ã‚’å®Œç’§ã«ã—ã¦ã‹ã‚‰å‡ºç™ºã™ã‚‹', feedback: 'æ…é‡ãªé¸æŠã§ã™ã€‚ç¢ºå®Ÿãªä¸€æ­©ãŒæˆåŠŸã¸ã®è¿‘é“ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚', icon: 'ğŸ’', weights: {fire:1,root:6,wind:2,water:1,light:0} },
      { letter: 'B', text: 'ç›´æ„Ÿã§ä»Šã™ãé£›ã³å‡ºã™', feedback: 'å†’é™ºå¿ƒã«æº¢ã‚ŒãŸé¸æŠã§ã™ã€‚æœªçŸ¥ã¸ã®ä¸€æ­©ãŒæ–°ã—ã„ä¸–ç•Œã‚’é–‹ãã§ã—ã‚‡ã†ã€‚', icon: 'ğŸƒ', weights: {fire:6,root:0,wind:1,water:2,light:1} },
      { letter: 'C', text: 'ä¿¡é ¼ã§ãã‚‹ä»²é–“ã‚’èª˜ã£ã¦ã‹ã‚‰å‡ºç™ºã™ã‚‹', feedback: 'å”èª¿æ€§ã®ã‚ã‚‹é¸æŠã§ã™ã€‚ä»²é–“ã¨ã®çµ†ãŒå¿ƒå¼·ã„æ”¯ãˆã«ãªã‚‹ã§ã—ã‚‡ã†ã€‚', icon: 'ğŸ¤', weights: {fire:2,root:3,wind:1,water:4,light:0} }
    ]
  },
  {
    number: 2,
    title: 'é­”æ³•ã®ã‚¢ã‚¤ãƒ†ãƒ é¸æŠ',
    theme: 'ä¾¡å€¤è¦³ã®å„ªå…ˆé †ä½',
    emoji: 'âœ¨',
    bgGradient: 'linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%)',
    narrative: 'å¤ä»£ã®ç¥ ã«ãŸã©ã‚Šç€ãã¨ã€\n3ã¤ã®é­”æ³•ã®ã‚¢ã‚¤ãƒ†ãƒ ãŒ\næ·¡ã„å…‰ã‚’æ”¾ã£ã¦ã„ã¾ã™ã€‚\n\nã—ã‹ã—ã€æŒã¦ã‚‹ã®ã¯ã²ã¨ã¤ã ã‘ã€‚\nã‚ãªãŸã¯ã©ã‚Œã‚’é¸ã³ã¾ã™ã‹ï¼Ÿ',
    choices: [
      { letter: 'A', text: 'æœªæ¥ã‚’è¦‹é€šã™ã€Œäºˆè¦‹ã®é¡ã€', feedback: 'å…ˆè¦‹ã®æ˜ã‚’æŒã¤é¸æŠã§ã™ã€‚æœªæ¥ã¸ã®æ´å¯ŸãŒåŠ›ã«ãªã‚‹ã§ã—ã‚‡ã†ã€‚', icon: 'ğŸ”®', weights: {fire:1,root:2,wind:5,water:1,light:1} },
      { letter: 'B', text: 'ã‚ã‚‰ã‚†ã‚‹å‚·ã‚’ç™’ã™ã€Œå‘½ã®è–¬ã€', feedback: 'æ…ˆæ„›ã«æº€ã¡ãŸé¸æŠã§ã™ã€‚ç™’ã—ã®åŠ›ãŒå¤šãã®ã‚‚ã®ã‚’æ•‘ã†ã§ã—ã‚‡ã†ã€‚', icon: 'ğŸ’Š', weights: {fire:0,root:2,wind:1,water:6,light:1} },
      { letter: 'C', text: 'çœŸå®Ÿã ã‘ã‚’èªã‚‹ã€Œèª å®Ÿã®ç¬›ã€', feedback: 'èª å®Ÿã•ã‚’é‡ã‚“ã˜ã‚‹é¸æŠã§ã™ã€‚çœŸå®Ÿã®åŠ›ãŒé“ã‚’åˆ‡ã‚Šé–‹ãã§ã—ã‚‡ã†ã€‚', icon: 'ğŸµ', weights: {fire:2,root:4,wind:2,water:1,light:1} }
    ]
  },
  {
    number: 3,
    title: 'è¿·ã„ã®æ£®ã®åˆ†ã‹ã‚Œé“',
    theme: 'æ„æ€æ±ºå®šã‚¹ã‚¿ã‚¤ãƒ«',
    emoji: 'ğŸŒ²',
    bgGradient: 'linear-gradient(135deg, #11998e 0%, #2d6a4f 50%, #1b4332 100%)',
    narrative: 'æ·±ã„æ£®ã®ä¸­ã§\nä¸‰ã¤ã®é“ãŒåˆ†ã‹ã‚Œã¦ã„ã¾ã™ã€‚\n\nå¤ã³ãŸé“æ¨™ã¯è‹”ã‚€ã—ã¦ã€\næ–‡å­—ãŒèª­ã‚ã¾ã›ã‚“ã€‚\n\nã‚ãªãŸã¯ã©ã†ã‚„ã£ã¦\né€²ã‚€é“ã‚’æ±ºã‚ã¾ã™ã‹ï¼Ÿ',
    choices: [
      { letter: 'A', text: 'å¤ã³ãŸåœ°å›³ã‚’é ¼ã‚Šã«é€²ã‚€', feedback: 'ç¢ºå®Ÿæ€§ã‚’é‡è¦–ã™ã‚‹é¸æŠã§ã™ã€‚çµŒé¨“ã¨çŸ¥è­˜ãŒç¢ºã‹ãªé“æ¨™ã«ãªã‚Šã¾ã™ã€‚', icon: 'ğŸ—ºï¸', weights: {fire:0,root:5,wind:3,water:1,light:1} },
      { letter: 'B', text: 'ç›´æ„Ÿã§é“ã‚’é¸ã¶', feedback: 'å†…ãªã‚‹å£°ã«å¾“ã†é¸æŠã§ã™ã€‚ç›´æ„ŸãŒæ€ã‚ã¬è¿‘é“ã‚’ç¤ºã™ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚', icon: 'ğŸ’«', weights: {fire:4,root:1,wind:1,water:3,light:1} },
      { letter: 'C', text: 'é«˜ã„æœ¨ã«ç™»ã£ã¦å…¨ä½“ã‚’è¦‹æ¸¡ã™', feedback: 'æˆ¦ç•¥çš„ãªé¸æŠã§ã™ã€‚ä¿¯ç°çš„ãªè¦–ç‚¹ãŒæœ€é©è§£ã‚’è¦‹ã¤ã‘ã¾ã™ã€‚', icon: 'ğŸŒ³', weights: {fire:2,root:2,wind:4,water:1,light:1} }
    ]
  },
  {
    number: 4,
    title: 'å›°ã£ã¦ã„ã‚‹æ£®ã®å‹•ç‰©',
    theme: 'ä»–è€…é–¢ä¸ã®å§¿å‹¢',
    emoji: 'ğŸ¦Š',
    bgGradient: 'linear-gradient(135deg, #F2994A 0%, #F2C94C 50%, #86E3CE 100%)',
    narrative: 'é“ã®é€”ä¸­ã§ã€\nå°ã•ãªç‹ãŒç½ ã«ã‹ã‹ã£ã¦\næ€¯ãˆã¦ã„ã¾ã™ã€‚\n\nå‚·ã¤ã„ãŸç›®ãŒ\nã‚ãªãŸã‚’è¦‹ä¸Šã’ã¦ã„ã¾ã™ã€‚\n\nã‚ãªãŸã¯ã©ã†ã—ã¾ã™ã‹ï¼Ÿ',
    choices: [
      { letter: 'A', text: 'ã™ãã«æ‰‹ã‚’å·®ã—ä¼¸ã¹ã¦åŠ©ã‘ã‚‹', feedback: 'å…±æ„ŸåŠ›ã«å¯Œã‚€é¸æŠã§ã™ã€‚å³åº§ã®è¡Œå‹•ãŒå±æ©Ÿã‚’æ•‘ã†ã§ã—ã‚‡ã†ã€‚', icon: 'ğŸ¤²', weights: {fire:2,root:1,wind:1,water:5,light:1} },
      { letter: 'B', text: 'ã¾ãšçŠ¶æ³ã‚’è¦³å¯Ÿã—ã¦åŸå› ã‚’æ¢ã‚‹', feedback: 'åˆ†æçš„ã§æ…é‡ãªé¸æŠã§ã™ã€‚æ ¹æœ¬çš„ãªè§£æ±ºã«ã¤ãªãŒã‚‹ã§ã—ã‚‡ã†ã€‚', icon: 'ğŸ”', weights: {fire:1,root:3,wind:4,water:1,light:1} },
      { letter: 'C', text: 'è‡ªåˆ†ã‚‚å­¦ã¹ã‚‹æ–¹æ³•ã§é–¢ã‚ã‚‹', feedback: 'æˆé•·å¿—å‘ã®é¸æŠã§ã™ã€‚ç›¸äº’åˆ©ç›ŠãŒæŒç¶šçš„ãªé–¢ä¿‚ã‚’ç¯‰ãã¾ã™ã€‚', icon: 'ğŸ“š', weights: {fire:3,root:2,wind:2,water:1,light:2} }
    ]
  },
  {
    number: 5,
    title: 'å¤ã„åŸã®ç§˜å¯†ã®éƒ¨å±‹',
    theme: 'å¥½å¥‡å¿ƒã¨è­¦æˆ’å¿ƒ',
    emoji: 'ğŸ°',
    bgGradient: 'linear-gradient(135deg, #4A4E69 0%, #22223B 50%, #2A2D43 100%)',
    narrative: 'å»ƒå¢Ÿã®åŸã‚’æ¢ç´¢ã—ã¦ã„ã‚‹ã¨ã€\nå£ã®å¥¥ã«éš ã•ã‚ŒãŸ\nå°ã•ãªæ‰‰ã‚’ç™ºè¦‹ã—ã¾ã—ãŸã€‚\n\næ‰‰ã®éš™é–“ã‹ã‚‰\nä¸æ€è­°ãªå…‰ãŒæ¼ã‚Œã¦ã„ã¾ã™ã€‚\n\nã‚ãªãŸã¯ã©ã†ã—ã¾ã™ã‹ï¼Ÿ',
    choices: [
      { letter: 'A', text: 'èˆˆå¥®ã—ã¦ã™ãã«å…¥ã£ã¦ã¿ã‚‹', feedback: 'å¥½å¥‡å¿ƒæ—ºç››ãªé¸æŠã§ã™ã€‚æ–°ã—ã„ç™ºè¦‹ãŒå¾…ã£ã¦ã„ã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚', icon: 'ğŸšª', weights: {fire:6,root:0,wind:2,water:1,light:1} },
      { letter: 'B', text: 'å‘¨å›²ã‚’è­¦æˆ’ã—ãªãŒã‚‰æ§˜å­ã‚’ã†ã‹ãŒã†', feedback: 'æ…é‡ã§è³¢æ˜ãªé¸æŠã§ã™ã€‚ãƒªã‚¹ã‚¯ç®¡ç†ãŒå®‰å…¨ã‚’ç¢ºä¿ã—ã¾ã™ã€‚', icon: 'ğŸ‘€', weights: {fire:1,root:5,wind:2,water:1,light:1} },
      { letter: 'C', text: 'ä»²é–“ã«å ±å‘Šã—ã¦ä¸€ç·’ã«èª¿ã¹ã‚‹', feedback: 'å”èª¿çš„ãªé¸æŠã§ã™ã€‚å…±æœ‰ã•ã‚ŒãŸå†’é™ºã¯ã‚ˆã‚Šè±Šã‹ãªçµŒé¨“ã«ãªã‚Šã¾ã™ã€‚', icon: 'ğŸ“¢', weights: {fire:2,root:2,wind:1,water:4,light:1} }
    ]
  },
  {
    number: 6,
    title: 'ç«œã¨ã®å¯¾è©±',
    theme: 'å¯¾ç«‹ã¸ã®ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ',
    emoji: 'ğŸ‰',
    bgGradient: 'linear-gradient(135deg, #e74c3c 0%, #c0392b 40%, #2c3e50 100%)',
    narrative: 'å±±ã®é ‚ã«ä½ã‚€\nå¤ã„ç«œã¨å‡ºä¼šã„ã¾ã—ãŸã€‚\n\nç«œã¯é ˜åŸŸã‚’ä¾µã•ã‚ŒãŸã¨æ€’ã‚Šã€\nç‚ã®æ¯ã‚’å¹ãæ§‹ãˆã§ã™ã€‚\n\nã‚ãªãŸã¯ã©ã†å¯¾å¿œã—ã¾ã™ã‹ï¼Ÿ',
    choices: [
      { letter: 'A', text: 'æˆ¦ã†æº–å‚™ã‚’æ•´ãˆã‚‹', feedback: 'å‹‡æ•¢ã§æ±ºæ–­åŠ›ã®ã‚ã‚‹é¸æŠã§ã™ã€‚æ™‚ã«ã¯æˆ¦ã„ãŒå¿…è¦ãªã“ã¨ã‚‚ã‚ã‚Šã¾ã™ã€‚', icon: 'âš”ï¸', weights: {fire:5,root:2,wind:1,water:1,light:1} },
      { letter: 'B', text: 'äº¤æ¸‰ã—ã¦å…±å­˜ã®é“ã‚’æ¢ã‚‹', feedback: 'å¹³å’Œçš„ãªé¸æŠã§ã™ã€‚å¯¾è©±ãŒæ–°ãŸãªå¯èƒ½æ€§ã‚’é–‹ãã¾ã™ã€‚', icon: 'ğŸ•Šï¸', weights: {fire:1,root:3,wind:3,water:2,light:1} },
      { letter: 'C', text: 'ã¾ãšç«œã®ç«‹å ´ã‚’ç†è§£ã—ã‚ˆã†ã¨ã™ã‚‹', feedback: 'å…±æ„Ÿçš„ã§æ·±ã„é¸æŠã§ã™ã€‚çœŸã®ç†è§£ãŒæ ¹æœ¬è§£æ±ºã‚’ã‚‚ãŸã‚‰ã—ã¾ã™ã€‚', icon: 'ğŸ’­', weights: {fire:1,root:1,wind:2,water:4,light:2} }
    ]
  },
  {
    number: 7,
    title: 'æ™‚é–“ã®ç ‚æ™‚è¨ˆ',
    theme: 'æ™‚é–“æ„è­˜',
    emoji: 'â³',
    bgGradient: 'linear-gradient(135deg, #D4A574 0%, #C49B68 40%, #8B6914 100%)',
    narrative: 'ä¸æ€è­°ãªç ‚æ™‚è¨ˆã‚’è¦‹ã¤ã‘ã¾ã—ãŸã€‚\nã“ã®ç ‚æ™‚è¨ˆã¯ã€\næ™‚é–“ã‚’æ“ã‚‹åŠ›ã‚’æŒã£ã¦ã„ã¾ã™ã€‚\n\nãŸã ã—ä½¿ãˆã‚‹ã®ã¯ä¸€åº¦ã ã‘ã€‚\n\nã‚ãªãŸã¯ã©ã†ä½¿ã„ã¾ã™ã‹ï¼Ÿ',
    choices: [
      { letter: 'A', text: 'éå»ã®å¤±æ•—ã‚’ã‚„ã‚Šç›´ã™', feedback: 'éå»ã¨å‘ãåˆã†é¸æŠã§ã™ã€‚ä¿®æ­£ãŒæ–°ãŸãªå‡ºç™ºç‚¹ã«ãªã‚Šã¾ã™ã€‚', icon: 'âª', weights: {fire:1,root:4,wind:2,water:2,light:1} },
      { letter: 'B', text: 'ç¾åœ¨ã®ä¸€ç¬ã‚’æœ€å¤§ã«ç”Ÿãã‚‹', feedback: 'ç¾åœ¨ä¸­å¿ƒã®é¸æŠã§ã™ã€‚ä»Šã“ã®ç¬é–“ãŒå…¨ã¦ã‚’å¤‰ãˆã‚‹åŠ›ã‚’æŒã¡ã¾ã™ã€‚', icon: 'âœ¨', weights: {fire:4,root:1,wind:1,water:3,light:1} },
      { letter: 'C', text: 'æœªæ¥ã®ãŸã‚ã«æ™‚é–“ã‚’è²¯ã‚ã‚‹', feedback: 'æœªæ¥å¿—å‘ã®é¸æŠã§ã™ã€‚è¨ˆç”»çš„ãªæº–å‚™ãŒè±Šã‹ãªæœªæ¥ã‚’ç¯‰ãã¾ã™ã€‚', icon: 'â©', weights: {fire:1,root:3,wind:4,water:1,light:1} }
    ]
  },
  {
    number: 8,
    title: 'ç¥­ã‚Šã®å¤œ',
    theme: 'ç¤¾ä¼šæ€§',
    emoji: 'ğŸª',
    bgGradient: 'linear-gradient(135deg, #FF6B6B 0%, #FFA07A 30%, #FFD700 70%, #FFA500 100%)',
    narrative: 'æ—…ã®é€”ä¸­ã€\næ‘ã®å¤§ããªç¥­ã‚Šã«å‡ºä¼šã„ã¾ã—ãŸã€‚\n\néŸ³æ¥½ã¨ç¬‘ã„å£°ãŒ\nå¤œç©ºã«éŸ¿ã„ã¦ã„ã¾ã™ã€‚\n\nã‚ãªãŸã¯ã©ã†éã”ã—ã¾ã™ã‹ï¼Ÿ',
    choices: [
      { letter: 'A', text: 'ç¥­ã‚Šã®ä¸­å¿ƒã§è¸Šã‚Šæ¥½ã—ã‚€', feedback: 'å¤–å‘çš„ã§æ´»ç™ºãªé¸æŠã§ã™ã€‚ã‚¨ãƒãƒ«ã‚®ãƒ¼ãŒå‘¨ã‚Šã‚’æ˜ã‚‹ãã—ã¾ã™ã€‚', icon: 'ğŸ’ƒ', weights: {fire:5,root:1,wind:1,water:2,light:1} },
      { letter: 'B', text: 'è£æ–¹ã§æ–™ç†ã‚„æº–å‚™ã‚’æ‰‹ä¼ã†', feedback: 'çŒ®èº«çš„ã§æ§ãˆã‚ãªé¸æŠã§ã™ã€‚ç¸ã®ä¸‹ã®åŠ›æŒã¡ãŒå…¨ä½“ã‚’æ”¯ãˆã¾ã™ã€‚', icon: 'ğŸ³', weights: {fire:1,root:4,wind:1,water:3,light:1} },
      { letter: 'C', text: 'å°‘ã—é›¢ã‚ŒãŸä¸˜ã‹ã‚‰çœºã‚ã‚‹', feedback: 'å†…çœçš„ã§è¦³å¯Ÿçš„ãªé¸æŠã§ã™ã€‚è·é›¢ãŒæ–°ãŸãªæ°—ã¥ãã‚’ã‚‚ãŸã‚‰ã—ã¾ã™ã€‚', icon: 'ğŸŒ™', weights: {fire:1,root:2,wind:4,water:1,light:2} }
    ]
  },
  {
    number: 9,
    title: 'ä¼èª¬ã®æ›¸ç‰©ã®ç™ºè¦‹',
    theme: 'çŸ¥è­˜ã¸ã®å‘ãåˆã„æ–¹',
    emoji: 'ğŸ“œ',
    bgGradient: 'linear-gradient(135deg, #1a1a2e 0%, #16213e 40%, #0f3460 100%)',
    narrative: 'æ—…ã®çµ‚ç›¤ã€\nä¼èª¬ã®å¤ã„æ›¸ç‰©ã‚’è¦‹ã¤ã‘ã¾ã—ãŸã€‚\n\nãã®ä¸­ã«ã¯ã€\nã“ã®ä¸–ç•Œã®çœŸç†ãŒ\nè¨˜ã•ã‚Œã¦ã„ã‚‹ã¨ã„ã„ã¾ã™ã€‚\n\nã‚ãªãŸã¯ã©ã†ã—ã¾ã™ã‹ï¼Ÿ',
    choices: [
      { letter: 'A', text: 'è‡ªåˆ†ã ã‘ã®çŸ¥è­˜ã¨ã—ã¦å¤§åˆ‡ã«ä¿ç®¡ã™ã‚‹', feedback: 'å€‹äººçš„ãªä¾¡å€¤ã‚’é‡è¦–ã™ã‚‹é¸æŠã§ã™ã€‚æ·±ã„å°‚é–€æ€§ãŒå¼·ã¿ã«ãªã‚Šã¾ã™ã€‚', icon: 'ğŸ”’', weights: {fire:2,root:4,wind:2,water:1,light:1} },
      { letter: 'B', text: 'çš†ã¨å…±æœ‰ã—ã¦ä¸€ç·’ã«å­¦ã¶', feedback: 'å…±æœ‰çš„ã§é–‹ã‹ã‚ŒãŸé¸æŠã§ã™ã€‚å…±æœ‰ãŒæ–°ãŸãªçŸ¥æµã‚’ç”Ÿã¿å‡ºã—ã¾ã™ã€‚', icon: 'ğŸ“–', weights: {fire:1,root:2,wind:1,water:5,light:1} },
      { letter: 'C', text: 'å®Ÿç”¨çš„ãªå¿œç”¨æ–¹æ³•ã‚’ç ”ç©¶ã™ã‚‹', feedback: 'å®Ÿè·µçš„ãªé¸æŠã§ã™ã€‚çŸ¥è­˜ã®æ´»ç”¨ãŒç¾å®Ÿã‚’å¤‰ãˆã‚‹åŠ›ã«ãªã‚Šã¾ã™ã€‚', icon: 'ğŸ”¬', weights: {fire:3,root:1,wind:4,water:1,light:1} }
    ]
  },
  {
    number: 10,
    title: 'ç‰©èªã®çµæœ«',
    theme: 'å®Œçµã®å½¢',
    emoji: 'ğŸŒŸ',
    bgGradient: 'linear-gradient(135deg, #FFD700 0%, #FFA500 30%, #FF6B6B 60%, #C44569 100%)',
    narrative: 'é•·ã„æ—…ãŒçµ‚ã‚ã‚Šã‚’è¿ãˆã¾ã™ã€‚\n\næŒ¯ã‚Šè¿”ã‚Œã°ã€\næ•°ãˆåˆ‡ã‚Œãªã„å‡ºä¼šã„ã¨\nåˆ¥ã‚ŒãŒã‚ã‚Šã¾ã—ãŸã€‚\n\nã‚ãªãŸã¯ã“ã®ç‰©èªã‚’\nã©ã†çµ‚ã‚ã‚‰ã›ã¾ã™ã‹ï¼Ÿ',
    choices: [
      { letter: 'A', text: 'è‹±é›„ã¨ã—ã¦æ•…éƒ·ã«å¸°é‚„ã™ã‚‹', feedback: 'æ „å…‰ã¨æ‰¿èªã‚’æ±‚ã‚ã‚‹é¸æŠã§ã™ã€‚é”æˆæ„ŸãŒæ¬¡ã®æ´»åŠ›ã«ãªã‚Šã¾ã™ã€‚', icon: 'ğŸ ', weights: {fire:4,root:3,wind:1,water:1,light:1} },
      { letter: 'B', text: 'æ–°ãŸãªå†’é™ºã¸ã™ãã«å‡ºç™ºã™ã‚‹', feedback: 'çµ‚ã‚ã‚Šãªãæ¢æ±‚ã®é¸æŠã§ã™ã€‚æ—…ãã®ã‚‚ã®ãŒç›®çš„ã«ãªã‚Šã¾ã™ã€‚', icon: 'ğŸš€', weights: {fire:5,root:0,wind:2,water:1,light:2} },
      { letter: 'C', text: 'å¹³å‡¡ã ãŒå¹³å’Œãªæ—¥å¸¸ã‚’é¸ã¶', feedback: 'å¹³ç©ã¨å®‰å®šã‚’é¸ã¶é¸æŠã§ã™ã€‚å°ã•ãªå¹¸ã›ã®ç©ã¿é‡ã­ãŒè±Šã‹ã•ã«ãªã‚Šã¾ã™ã€‚', icon: 'ğŸŒ¸', weights: {fire:0,root:6,wind:1,water:2,light:1} }
    ]
  }
];

const TYPES = {
  fire_wind: { nameJa: 'è‡ªç”±ãªæ¢æ¤œå®¶', nameEn: 'Free Explorer', icon: 'ğŸ”¥ğŸŒªï¸', desc: 'å¥½å¥‡å¿ƒã¨çŸ¥æ€§ã‚’æ­¦å™¨ã«ã€å¸¸ã«æ–°ã—ã„åœ°å¹³ã‚’ç›®æŒ‡ã™å†’é™ºè€…ã€‚å›ºå®šè¦³å¿µã«ç¸›ã‚‰ã‚Œãšã€è‡ªç”±ãªç™ºæƒ³ã§ä¸–ç•Œã‚’åˆ‡ã‚Šæ‹“ãã¾ã™ã€‚', strengths: ['å‰µé€ çš„', 'é©å¿œåŠ›ãŒé«˜ã„', 'å­¦ç¿’æ„æ¬²ãŒå¼·ã„', 'ã‚ªãƒ¼ãƒ—ãƒ³ãƒã‚¤ãƒ³ãƒ‰'], weaknesses: ['é£½ãã‚„ã™ã„', 'ç¶™ç¶šæ€§ã«æ¬ ã‘ã‚‹', 'æ·±ã¿ã«æ¬ ã‘ã‚‹ã“ã¨ãŒã‚ã‚‹'], archetype: 'ãƒˆãƒªãƒƒã‚¯ã‚¹ã‚¿ãƒ¼ï¼æ¢æ±‚è€…', advice: 'AIã‚’ã€Œå†’é™ºã®ç›¸æ£’ã€ã¨ã—ã¦æ‰±ã„ã¾ã—ã‚‡ã†ã€‚æ–°ã—ã„ã‚¢ã‚¤ãƒ‡ã‚¢ã®å…±å‰µè€…ã¨ã—ã¦æ´»ç”¨ã—ã¦ãã ã•ã„ã€‚' },
  fire_water: { nameJa: 'æƒ…ç†±çš„å…±æ„Ÿè€…', nameEn: 'Passionate Empath', icon: 'ğŸ”¥ğŸ’§', desc: 'æƒ…ç†±ã¨å…±æ„ŸåŠ›ã‚’ä½µã›æŒã¡ã€äººã€…ã®å¿ƒã‚’å‹•ã‹ã™ã‚«ãƒªã‚¹ãƒã€‚æ„Ÿæƒ…çš„ã«æ·±ãé–¢ã‚ã‚ŠãªãŒã‚‰ã‚‚ã€å‰å‘ããªã‚¨ãƒãƒ«ã‚®ãƒ¼ã‚’ä¼æ’­ã•ã›ã¾ã™ã€‚', strengths: ['æƒ…ç†±çš„', 'å…±æ„ŸåŠ›ãŒé«˜ã„', 'äººã‚’é¼“èˆã§ãã‚‹', 'æ„Ÿæƒ…çš„æ·±åº¦'], weaknesses: ['æ„Ÿæƒ…çš„æ¶ˆè€—ãŒå¤§ãã„', 'å®¢è¦³æ€§ã«æ¬ ã‘ã‚‹', 'è¡å‹•çš„'], archetype: 'æ‹äººï¼ç™’ã—æ‰‹', advice: 'AIã‚’ã€Œæ„Ÿæƒ…çš„ãªã‚µã‚¦ãƒ³ãƒ‰ãƒœãƒ¼ãƒ‰ã€ã¨ã—ã¦ä½¿ã„ã¾ã—ã‚‡ã†ã€‚æƒ…ç†±çš„ãªã‚¢ã‚¤ãƒ‡ã‚¢ã‚’å®¢è¦³çš„ã«æŒ¯ã‚Šè¿”ã‚‹é¡ã¨ã—ã¦æ´»ç”¨ã—ã¦ãã ã•ã„ã€‚' },
  fire_root: { nameJa: 'æŒ‘æˆ¦ã™ã‚‹å®ˆè­·è€…', nameEn: 'Challenging Guardian', icon: 'ğŸ”¥ğŸŒ¿', desc: 'ä¼çµ±ã¨å®‰å®šã‚’åŸºç›¤ã¨ã—ã¤ã¤ã€ç¾çŠ¶ã«æŒ‘æˆ¦ã™ã‚‹æ”¹é©è€…ã€‚å¤‰åŒ–ã‚’ã‚‚ãŸã‚‰ã—ãªãŒã‚‰ã‚‚ã€åŸºç›¤ã‚’ã—ã£ã‹ã‚Šå®ˆã‚‹ãƒãƒ©ãƒ³ã‚¹æ„Ÿè¦šã‚’æŒã¡ã¾ã™ã€‚', strengths: ['ç¾å®Ÿçš„', 'å®Ÿè¡ŒåŠ›ãŒã‚ã‚‹', 'è²¬ä»»æ„ŸãŒå¼·ã„', 'æŒç¶šçš„'], weaknesses: ['é ‘å›º', 'æŸ”è»Ÿæ€§ã«æ¬ ã‘ã‚‹', 'é©æ–°æ€§ä¸è¶³'], archetype: 'è‹±é›„ï¼å®ˆè­·è€…', advice: 'AIã‚’ã€Œä¿¡é ¼ã§ãã‚‹å‚è¬€ã€ã¨ã—ã¦æ´»ç”¨ã—ã¾ã—ã‚‡ã†ã€‚è¨ˆç”»ã®å®Ÿè¡Œã‚’æ”¯ãˆã‚‹ãƒ„ãƒ¼ãƒ«ã¨ã—ã¦æœ€é©ã§ã™ã€‚' },
  fire_light: { nameJa: 'é©å‘½çš„ãªå¤¢æƒ³å®¶', nameEn: 'Revolutionary Dreamer', icon: 'ğŸ”¥âœ¨', desc: 'ç†æƒ³ã¨æƒ…ç†±ã‚’æ­¦å™¨ã«ã€ç¾çŠ¶ã‚’æ‰“ç ´ã™ã‚‹ãƒ“ã‚¸ãƒ§ãƒŠãƒªãƒ¼ã€‚é«˜ã„ç†æƒ³ã‚’æ²ã’ã€æƒ…ç†±çš„ã«å¤‰é©ã‚’æ¨é€²ã—ã¾ã™ã€‚', strengths: ['ç†æƒ³ä¸»ç¾©çš„', 'æƒ…ç†±çš„', 'å¤‰é©åŠ›ãŒã‚ã‚‹', 'ã‚¤ãƒ³ã‚¹ãƒ”ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³è±Šã‹'], weaknesses: ['ç¾å®Ÿé›¢ã‚Œ', 'æŒç¶šæ€§ã«æ¬ ã‘ã‚‹', 'ç‡ƒãˆå°½ãã‚„ã™ã„'], archetype: 'é è¨€è€…ï¼é©å‘½å®¶', advice: 'AIã‚’ã€Œç†æƒ³ã¨ç¾å®Ÿã®æ©‹æ¸¡ã—å½¹ã€ã¨ã—ã¦ä½¿ã„ã¾ã—ã‚‡ã†ã€‚ãƒ“ã‚¸ãƒ§ãƒ³ã‚’å…·ä½“çš„ãªã‚¹ãƒ†ãƒƒãƒ—ã«è½ã¨ã—è¾¼ã‚€æ”¯æ´ã‚’æ±‚ã‚ã¦ãã ã•ã„ã€‚' },
  root_fire: { nameJa: 'å …å®Ÿãªé–‹æ‹“è€…', nameEn: 'Practical Pioneer', icon: 'ğŸŒ¿ğŸ”¥', desc: 'å®‰å®šã‚’ç¢ºä¿ã—ãªãŒã‚‰ã‚‚ã€ç¢ºå®Ÿã«å‰é€²ã™ã‚‹å®Ÿè·µå®¶ã€‚ãƒªã‚¹ã‚¯ã‚’è¨ˆç®—ã—ãŸä¸Šã§ã€ç€å®Ÿã«æ–°ã—ã„é ˜åŸŸã‚’é–‹æ‹“ã—ã¾ã™ã€‚', strengths: ['ç¾å®Ÿçš„', 'è¨ˆç”»æ€§ãŒã‚ã‚‹', 'æŒç¶šçš„', 'å®Ÿè¡ŒåŠ›'], weaknesses: ['å†’é™ºå¿ƒãŒåˆ¶é™ã•ã‚Œã‚‹', 'å¤‰åŒ–ã«æ¶ˆæ¥µçš„', 'ã‚¹ãƒ”ãƒ¼ãƒ‰ä¸è¶³'], archetype: 'é–‹æ‹“è€…ï¼å®Ÿå‹™å®¶', advice: 'AIã‚’ã€ŒåŠ¹ç‡åŒ–ã®é”äººã€ã¨ã—ã¦ä½¿ã„ã¾ã—ã‚‡ã†ã€‚ãƒ«ãƒ¼ãƒãƒ³ãƒ¯ãƒ¼ã‚¯ã‚’ä»»ã›ã€æœ¬è³ªçš„ãªåˆ¤æ–­ã«é›†ä¸­ã—ã¦ãã ã•ã„ã€‚' },
  root_water: { nameJa: 'æ¸©ã‹ãªä¿è­·è€…', nameEn: 'Warm Protector', icon: 'ğŸŒ¿ğŸ’§', desc: 'å®‰å®šã¨æ¸©ã‹ã•ã§å‘¨ã‚Šã‚’åŒ…ã¿è¾¼ã‚€ä¿è­·è€…ã€‚ä¼çµ±ã‚„çµ†ã‚’å¤§åˆ‡ã«ã—ã€æƒ…ç·’çš„ã«å®‰å…¨ãªç’°å¢ƒã‚’ä½œã‚Šå‡ºã—ã¾ã™ã€‚', strengths: ['ä¿¡é ¼ã§ãã‚‹', 'çŒ®èº«çš„', 'æƒ…ç·’çš„ã«å®‰å®š', 'å”èª¿çš„'], weaknesses: ['è‡ªå·±çŠ ç‰²çš„', 'å¤‰åŒ–ã«æŠµæŠ—', 'è‡ªå·±ä¸»å¼µãŒå¼±ã„'], archetype: 'é¤Šè‚²è€…ï¼ä¿è­·è€…', advice: 'AIã‚’ã€Œä¿¡é ¼ã§ãã‚‹åŸ·äº‹ã€ã¨ã—ã¦æ‰±ã„ã¾ã—ã‚‡ã†ã€‚æ—¥å¸¸ã®ç…©é›‘ãªä½œæ¥­ã‚’ä»»ã›ã€å¤§åˆ‡ãªäººã¨ã®æ™‚é–“ã‚’ä½œã‚Šã¾ã—ã‚‡ã†ã€‚' },
  root_wind: { nameJa: 'ä½“ç³»çš„ãªç®¡ç†è€…', nameEn: 'Systematic Manager', icon: 'ğŸŒ¿ğŸŒªï¸', desc: 'ç§©åºã¨è«–ç†ã‚’é‡ã‚“ã˜ã€åŠ¹ç‡çš„ãªã‚·ã‚¹ãƒ†ãƒ ã‚’æ§‹ç¯‰ã™ã‚‹ç®¡ç†è€…ã€‚ä¼çµ±çš„ãªçŸ¥æµã¨ç¾ä»£çš„ãªåˆç†æ€§ã‚’èåˆã•ã›ã¾ã™ã€‚', strengths: ['çµ„ç¹”çš„', 'è«–ç†çš„', 'åŠ¹ç‡çš„', 'ä¿¡é ¼æ€§ãŒé«˜ã„'], weaknesses: ['æŸ”è»Ÿæ€§ã«æ¬ ã‘ã‚‹', 'äººé–“å‘³ã«æ¬ ã‘ã‚‹', 'å‰µé€ æ€§ä¸è¶³'], archetype: 'ç®¡ç†è€…ï¼å»ºç¯‰å®¶', advice: 'AIã‚’ã€Œãƒ‡ãƒ¼ã‚¿åˆ†æã®ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ã€ã¨ã—ã¦æ´»ç”¨ã—ã¾ã—ã‚‡ã†ã€‚ã‚·ã‚¹ãƒ†ãƒ æ”¹å–„ã®ææ¡ˆã‚’æ±‚ã‚ã¦ã¿ã¦ãã ã•ã„ã€‚' },
  root_light: { nameJa: 'ä¼çµ±çš„å“²å­¦è€…', nameEn: 'Traditional Philosopher', icon: 'ğŸŒ¿âœ¨', desc: 'ä¼çµ±ã®ä¸­ã«æ·±ã„çŸ¥æµã‚’è¦‹å‡ºã—ã€ç¾ä»£ã«æ´»ã‹ã™å“²å­¦è€…ã€‚å¤ãè‰¯ãä¾¡å€¤è¦³ã‚’å®ˆã‚Šã¤ã¤ã€ç²¾ç¥çš„æˆé•·ã‚’è¿½æ±‚ã—ã¾ã™ã€‚', strengths: ['çŸ¥æµãŒã‚ã‚‹', 'æ€æ…®æ·±ã„', 'ä¼çµ±ã‚’é‡ã‚“ã˜ã‚‹', 'ç²¾ç¥çš„'], weaknesses: ['ç¾å®Ÿé›¢ã‚Œ', 'å¤‰åŒ–ã«æŠµæŠ—', 'é–‰é–çš„'], archetype: 'è³¢è€…ï¼å“²å­¦è€…', advice: 'AIã‚’ã€ŒçŸ¥æµã®è”µã€ã¨ã—ã¦ä½¿ã„ã¾ã—ã‚‡ã†ã€‚å¤ä»Šæ±è¥¿ã®çŸ¥æµã‚’æ¯”è¼ƒãƒ»çµ±åˆã™ã‚‹å¯¾è©±ç›¸æ‰‹ã¨ã—ã¦æœ€é©ã§ã™ã€‚' },
  wind_fire: { nameJa: 'çŸ¥çš„å†’é™ºå®¶', nameEn: 'Intellectual Adventurer', icon: 'ğŸŒªï¸ğŸ”¥', desc: 'çŸ¥æ€§ã¨å¥½å¥‡å¿ƒã‚’æ­¦å™¨ã«ã€æ€æƒ³çš„å†’é™ºã‚’æ¥½ã—ã‚€æ¢æ±‚è€…ã€‚ç†è«–ã¨å®Ÿè·µã‚’çµã³ã¤ã‘ã€æ–°ã—ã„ãƒ‘ãƒ©ãƒ€ã‚¤ãƒ ã‚’å‰µé€ ã—ã¾ã™ã€‚', strengths: ['çŸ¥çš„', 'å‰µé€ çš„', 'åˆ†æçš„', 'é©å¿œåŠ›ãŒã‚ã‚‹'], weaknesses: ['æ„Ÿæƒ…çš„æ·±åº¦ã«æ¬ ã‘ã‚‹', 'æŒç¶šæ€§ä¸è¶³', 'äººé–“é–¢ä¿‚ãŒæµ…ã„'], archetype: 'ç™ºæ˜å®¶ï¼å…ˆé§†è€…', advice: 'AIã‚’ã€Œæ€è€ƒå®Ÿé¨“ã®ç›¸æ£’ã€ã¨ã—ã¦ä½¿ã„ã¾ã—ã‚‡ã†ã€‚ä»®èª¬æ¤œè¨¼ã‚„ç†è«–å±•é–‹ã®ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ã¨ã—ã¦æ´»ç”¨ã—ã¦ãã ã•ã„ã€‚' },
  wind_water: { nameJa: 'åˆ†æçš„ãªä»²ä»‹è€…', nameEn: 'Analytical Mediator', icon: 'ğŸŒªï¸ğŸ’§', desc: 'è«–ç†ã¨å…±æ„Ÿã®ãƒãƒ©ãƒ³ã‚¹ã‚’å–ã‚Šã€èª¿å’Œã‚’ã‚‚ãŸã‚‰ã™ä»²ä»‹è€…ã€‚å®¢è¦³æ€§ã‚’æŒã¡ãªãŒã‚‰ã‚‚ã€äººé–“é–¢ä¿‚ã®æ©Ÿå¾®ã‚’ç†è§£ã—ã¾ã™ã€‚', strengths: ['å…¬å¹³', 'åˆ†æçš„', 'å…±æ„ŸåŠ›ãŒã‚ã‚‹', 'èª¿æ•´åŠ›'], weaknesses: ['æ±ºæ–­åŠ›ã«æ¬ ã‘ã‚‹', 'æ„Ÿæƒ…çš„è·é›¢ã‚’å–ã‚Šã™ãã‚‹', 'ä¸»ä½“æ€§ä¸è¶³'], archetype: 'èª¿åœè€…ï¼è¦³å¯Ÿè€…', advice: 'AIã‚’ã€Œåˆ†æã¨å…±æ„Ÿã®æ©‹æ¸¡ã—å½¹ã€ã¨ã—ã¦ä½¿ã„ã¾ã—ã‚‡ã†ã€‚ãƒ‡ãƒ¼ã‚¿ã«åŸºã¥ã„ãŸäººé–“é–¢ä¿‚ã®ã‚¢ãƒ‰ãƒã‚¤ã‚¹ã‚’æ±‚ã‚ã¦ã¿ã¦ãã ã•ã„ã€‚' },
  wind_root: { nameJa: 'æˆ¦ç•¥çš„è¨ˆç”»è€…', nameEn: 'Strategic Planner', icon: 'ğŸŒªï¸ğŸŒ¿', desc: 'è‡ªç”±ã¨å®‰å®šã®ãƒãƒ©ãƒ³ã‚¹ã‚’è¨ˆç®—ã—ã€é•·æœŸçš„ãªè¨ˆç”»ã‚’ç«‹ã¦ã‚‹æˆ¦ç•¥å®¶ã€‚ç¾å®Ÿçš„åˆ¶ç´„ã®ä¸­ã§æœ€å¤§ã®è‡ªç”±ã‚’è¨­è¨ˆã—ã¾ã™ã€‚', strengths: ['æˆ¦ç•¥çš„', 'ç¾å®Ÿçš„', 'è¨ˆç”»æ€§ãŒã‚ã‚‹', 'åŠ¹ç‡çš„'], weaknesses: ['å†’é™ºå¿ƒãŒä¸è¶³', 'æŸ”è»Ÿæ€§ã«æ¬ ã‘ã‚‹', 'æ¥½ã—ã‚€ã“ã¨ã‚’å¿˜ã‚Œã‚‹'], archetype: 'æˆ¦ç•¥å®¶ï¼è¨­è¨ˆè€…', advice: 'AIã‚’ã€Œæˆ¦ç•¥ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼ã€ã¨ã—ã¦ä½¿ã„ã¾ã—ã‚‡ã†ã€‚è¤‡æ•°ã®ã‚·ãƒŠãƒªã‚ªã‚’æ¯”è¼ƒæ¤œè¨ã™ã‚‹æ”¯æ´ã‚’æ±‚ã‚ã¦ãã ã•ã„ã€‚' },
  wind_light: { nameJa: 'çœŸç†ã®æ¢ç©¶è€…', nameEn: 'Truth Seeker', icon: 'ğŸŒªï¸âœ¨', desc: 'çŸ¥æ€§ã¨ç†æƒ³ã‚’è¿½æ±‚ã—ã€çµ¶å¯¾çš„ãªçœŸç†ã‚’æ¢æ±‚ã™ã‚‹å“²å­¦è€…ã€‚è«–ç†çš„æ€è€ƒã¨ç²¾ç¥çš„æ¢æ±‚ã‚’çµ±åˆã•ã›ã¾ã™ã€‚', strengths: ['å“²å­¦çš„', 'çŸ¥çš„', 'æ¢ç©¶å¿ƒãŒå¼·ã„', 'æ­£ç›´'], weaknesses: ['ç¾å®Ÿçš„ã§ãªã„', 'å­¤ç‹¬', 'å®Ÿè·µæ€§ã«æ¬ ã‘ã‚‹'], archetype: 'æ¢ç©¶è€…ï¼ç¥ç§˜å®¶', advice: 'AIã‚’ã€Œå“²å­¦çš„å¯¾è©±è€…ã€ã¨ã—ã¦æ‰±ã„ã¾ã—ã‚‡ã†ã€‚æŠ½è±¡çš„ãªæ¦‚å¿µã‚’å…·ä½“åŒ–ã™ã‚‹ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ã¨ã—ã¦æ´»ç”¨ã—ã¦ãã ã•ã„ã€‚' },
  water_fire: { nameJa: 'å…±æ„Ÿã®ãƒªãƒ¼ãƒ€ãƒ¼', nameEn: 'Empathetic Leader', icon: 'ğŸ’§ğŸ”¥', desc: 'æ„Ÿæƒ…çš„ãªæ·±ã•ã¨æƒ…ç†±ã§äººã€…ã‚’å°ããƒªãƒ¼ãƒ€ãƒ¼ã€‚å…±æ„ŸåŠ›ã‚’æŒã¡ãªãŒã‚‰ã‚‚ã€å‰å‘ããªã‚¨ãƒãƒ«ã‚®ãƒ¼ã§é›†å›£ã‚’å‹•ã‹ã—ã¾ã™ã€‚', strengths: ['å…±æ„ŸåŠ›ãŒé«˜ã„', 'æƒ…ç†±çš„', 'äººã‚’å‹•ã‹ã›ã‚‹', 'æ„Ÿæƒ…çš„æ·±åº¦'], weaknesses: ['æ„Ÿæƒ…çš„æ¶ˆè€—', 'å®¢è¦³æ€§ä¸è¶³', 'è¡å‹•çš„'], archetype: 'ã‚«ãƒªã‚¹ãƒï¼å°ãæ‰‹', advice: 'AIã‚’ã€Œãƒªãƒ¼ãƒ€ãƒ¼ã‚·ãƒƒãƒ—ã‚³ãƒ¼ãƒã€ã¨ã—ã¦ä½¿ã„ã¾ã—ã‚‡ã†ã€‚æ„Ÿæƒ…ã¨è«–ç†ã®ãƒãƒ©ãƒ³ã‚¹ã‚’å–ã‚‹åŠ©è¨€ã‚’æ±‚ã‚ã¦ãã ã•ã„ã€‚' },
  water_root: { nameJa: 'æƒ…ç·’çš„å®‰å®šå‰¤', nameEn: 'Emotional Stabilizer', icon: 'ğŸ’§ğŸŒ¿', desc: 'æƒ…ç·’çš„ãªå®‰å®šæ„Ÿã§å‘¨å›²ã‚’æ”¯ãˆã‚‹å­˜åœ¨ã€‚æ¸©ã‹ã•ã¨ä¸€è²«æ€§ã§ã€å®‰å…¨ãªæ„Ÿæƒ…çš„ç’°å¢ƒã‚’æä¾›ã—ã¾ã™ã€‚', strengths: ['æƒ…ç·’çš„ã«å®‰å®š', 'ä¿¡é ¼ã§ãã‚‹', 'çŒ®èº«çš„', 'å”èª¿çš„'], weaknesses: ['è‡ªå·±çŠ ç‰²çš„', 'è‡ªå·±ä¸»å¼µãŒå¼±ã„', 'å†’é™ºå¿ƒä¸è¶³'], archetype: 'é¤Šè‚²è€…ï¼åŸºç›¤', advice: 'AIã‚’ã€Œè‡ªåˆ†æ™‚é–“ã®ç¢ºä¿ãƒ„ãƒ¼ãƒ«ã€ã¨ã—ã¦ä½¿ã„ã¾ã—ã‚‡ã†ã€‚ä»–è€…ã®ã‚µãƒãƒ¼ãƒˆã¨è‡ªåˆ†ã®ã‚±ã‚¢ã®ãƒãƒ©ãƒ³ã‚¹ã‚’æ”¯æ´ã—ã¦ã‚‚ã‚‰ã£ã¦ãã ã•ã„ã€‚' },
  water_wind: { nameJa: 'èª¿åœã™ã‚‹è¦³å¯Ÿè€…', nameEn: 'Mediating Observer', icon: 'ğŸ’§ğŸŒªï¸', desc: 'å®¢è¦³æ€§ã¨å…±æ„ŸåŠ›ã®ãƒãƒ©ãƒ³ã‚¹ã§ã€äººé–“é–¢ä¿‚ã‚’èª¿æ•´ã™ã‚‹è¦³å¯Ÿè€…ã€‚æ„Ÿæƒ…ã‚’ç†è§£ã—ã¤ã¤ã€åˆç†çš„ãªè§£æ±ºç­–ã‚’ææ¡ˆã—ã¾ã™ã€‚', strengths: ['å…¬å¹³', 'å…±æ„ŸåŠ›ãŒã‚ã‚‹', 'åˆ†æçš„', 'èª¿æ•´åŠ›'], weaknesses: ['æ„Ÿæƒ…çš„è·é›¢', 'ä¸»ä½“æ€§ä¸è¶³', 'æ±ºæ–­åŠ›ä¸è¶³'], archetype: 'è¦³å¯Ÿè€…ï¼ä»²ä»‹è€…', advice: 'AIã‚’ã€Œå®¢è¦³çš„ãªé¡ã€ã¨ã—ã¦ä½¿ã„ã¾ã—ã‚‡ã†ã€‚æ„Ÿæƒ…ã¨è«–ç†ã®ä¸¡é¢ã‹ã‚‰çŠ¶æ³ã‚’åˆ†æã™ã‚‹æ”¯æ´ã‚’æ±‚ã‚ã¦ãã ã•ã„ã€‚' },
  water_light: { nameJa: 'ç™’ã—ã®å°ãæ‰‹', nameEn: 'Healing Guide', icon: 'ğŸ’§âœ¨', desc: 'å…±æ„ŸåŠ›ã¨ç²¾ç¥çš„æ·±ã•ã§ã€ä»–è€…ã®æˆé•·ã‚’ä¿ƒã™å°ãæ‰‹ã€‚æ„Ÿæƒ…çš„ãªç™’ã—ã¨ç²¾ç¥çš„æˆé•·ã‚’æ”¯æ´ã—ã¾ã™ã€‚', strengths: ['ç™’ã—ã®åŠ›ãŒã‚ã‚‹', 'å…±æ„ŸåŠ›ãŒé«˜ã„', 'ç²¾ç¥çš„', 'æˆé•·å¿—å‘'], weaknesses: ['ç¾å®Ÿçš„ã§ãªã„', 'è‡ªå·±çŠ ç‰²çš„', 'å®Ÿè·µæ€§ä¸è¶³'], archetype: 'ç™’ã—æ‰‹ï¼éœŠçš„æŒ‡å°è€…', advice: 'AIã‚’ã€Œå†…é¢ã®å¯¾è©±ãƒ„ãƒ¼ãƒ«ã€ã¨ã—ã¦ä½¿ã„ã¾ã—ã‚‡ã†ã€‚è‡ªå·±ç†è§£ã¨ä»–è€…ç†è§£ã‚’æ·±ã‚ã‚‹ãŸã‚ã®å•ã„ã‹ã‘ã‚’æ±‚ã‚ã¦ãã ã•ã„ã€‚' }
};

const PARAM_META = {
  fire:  { name: 'ç‚', icon: 'ğŸ”¥', color: '#E85D4A', label: 'æƒ…ç†±ãƒ»å†’é™º' },
  root:  { name: 'æ ¹', icon: 'ğŸŒ¿', color: '#5BA37A', label: 'å®‰å®šãƒ»åŸºç›¤' },
  wind:  { name: 'é¢¨', icon: 'ğŸŒªï¸', color: '#4A8DB7', label: 'çŸ¥æ€§ãƒ»è‡ªç”±' },
  water: { name: 'æ°´', icon: 'ğŸ’§', color: '#6BB5A0', label: 'å…±æ„Ÿãƒ»èª¿å’Œ' },
  light: { name: 'å…‰', icon: 'âœ¨', color: '#C9A84C', label: 'ç†æƒ³ãƒ»ç²¾ç¥' }
};

// ===== STATE =====
let currentStory = 0;
let answers = [];
let scores = { fire: 0, root: 0, wind: 0, water: 0, light: 0 };

// ===== FUNCTIONS =====
function showScreen(id) {
  document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
  document.getElementById(id).classList.add('active');
}

function openBook() {
  const cover = document.querySelector('.book-cover');
  cover.style.animation = 'none';
  cover.style.transition = 'transform 0.8s ease, opacity 0.6s ease';
  cover.style.transform = 'rotateY(-90deg) scale(0.9)';
  cover.style.opacity = '0';
  setTimeout(() => showScreen('introScreen'), 500);
}

function startDiagnosis() {
  currentStory = 0;
  answers = [];
  scores = { fire: 0, root: 0, wind: 0, water: 0, light: 0 };
  playStoryVideo();
}

function playStoryVideo() {
  videoPlaying = true;
  const story = STORIES[currentStory];
  const videoSrc = storyVideoPath(story.number);
  const overlay = document.getElementById('videoOverlay');
  const video = document.getElementById('storyVideo');
  const label = document.getElementById('videoChapterLabel');

  // ãƒãƒ£ãƒ—ã‚¿ãƒ¼ãƒ©ãƒ™ãƒ«è¨­å®š
  label.textContent = `â€• ç¬¬${story.number}è©± â€• ${story.title}`;
  label.style.animation = 'none';
  label.offsetHeight; // reflow
  label.style.animation = 'fadeIn 1s ease 0.5s forwards';
  label.style.opacity = '0';

  // å‹•ç”»è¨­å®š
  video.src = videoSrc;
  video.currentTime = 0;
  video.muted = false;

  // è¡¨ç¤º
  overlay.classList.add('show');

  // å†ç”Ÿ
  video.play().catch(() => {
    // è‡ªå‹•å†ç”Ÿãƒ–ãƒ­ãƒƒã‚¯æ™‚ã¯ãƒŸãƒ¥ãƒ¼ãƒˆã§å†ç”Ÿ
    video.muted = true;
    video.play().catch(() => {
      // ãã‚Œã§ã‚‚ãƒ€ãƒ¡ãªã‚‰ã‚¹ã‚­ãƒƒãƒ—
      finishVideo();
    });
  });

  // å‹•ç”»çµ‚äº†æ™‚
  video.onended = () => {
    finishVideo();
  };

  // ã‚¨ãƒ©ãƒ¼æ™‚ï¼ˆå‹•ç”»ãƒ•ã‚¡ã‚¤ãƒ«ãŒãªã„å ´åˆï¼‰
  video.onerror = () => {
    finishVideo();
  };
}

let videoPlaying = false;

function skipVideo() {
  const video = document.getElementById('storyVideo');
  video.pause();
  video.onended = null;
  video.onerror = null;
  finishVideo();
}

function finishVideo() {
  if (!videoPlaying) return;
  videoPlaying = false;

  const overlay = document.getElementById('videoOverlay');
  const video = document.getElementById('storyVideo');

  // ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©ã‚’å…ˆã«ã‚¯ãƒªã‚¢
  video.onended = null;
  video.onerror = null;

  // ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¢ã‚¦ãƒˆ
  overlay.classList.remove('show');

  setTimeout(() => {
    video.pause();
    video.removeAttribute('src');
    showScreen('storyScreen');
    renderStory();
  }, 500);
}

function renderStory() {
  const story = STORIES[currentStory];
  const progress = ((currentStory) / STORIES.length) * 100;
  document.getElementById('progressFill').style.width = progress + '%';

  const imgSrc = storyImagePath(story.number);

  const content = document.getElementById('storyContent');
  content.scrollTop = 0;
  content.innerHTML = `
    <div class="story-illustration fade-in" id="storyIllust">
      <div class="scene-bg" style="background: ${story.bgGradient};"></div>
      <div class="scene-emoji">${story.emoji}</div>
      <img src="${imgSrc}" alt="${story.title}" onerror="this.parentElement.classList.add('no-image');">
    </div>
    <div class="chapter-num fade-in-up delay-1">â€• ç¬¬${story.number}è©± â€•</div>
    <div class="page-title fade-in-up delay-2">${story.title}</div>
    <div class="page-divider fade-in-up delay-2">âœ¦</div>
    <div class="narrative-text fade-in-up delay-3">${story.narrative.replace(/\n/g, '<br>')}</div>
    <div class="choices-container">
      ${story.choices.map((c, i) => `
        <button class="choice-btn fade-in-up delay-${i + 4}" onclick="selectChoice(${i})">
          <span class="choice-letter">${c.letter}</span>
          <span>${c.text}</span>
        </button>
      `).join('')}
    </div>
  `;
}

function selectChoice(index) {
  const story = STORIES[currentStory];
  const choice = story.choices[index];

  Object.keys(choice.weights).forEach(param => {
    scores[param] += choice.weights[param];
  });

  answers.push({
    storyNumber: story.number,
    choiceLetter: choice.letter,
    choiceIndex: index
  });

  document.querySelectorAll('.choice-btn').forEach((btn, i) => {
    if (i === index) btn.classList.add('selected');
    btn.style.pointerEvents = 'none';
  });

  setTimeout(() => {
    const overlay = document.getElementById('feedbackOverlay');
    document.getElementById('feedbackIcon').textContent = choice.icon;
    document.getElementById('feedbackText').textContent = choice.feedback;

    if (currentStory >= STORIES.length - 1) {
      document.getElementById('nextBtn').textContent = 'çµæœã‚’è¦‹ã‚‹ âœ¦';
    } else {
      document.getElementById('nextBtn').textContent = 'æ¬¡ã®ç‰©èªã¸ â–¸';
    }

    overlay.classList.add('show');
  }, 400);
}

function nextStory() {
  document.getElementById('feedbackOverlay').classList.remove('show');
  currentStory++;

  if (currentStory >= STORIES.length) {
    document.getElementById('loadingScreen').classList.add('show');
    setTimeout(() => {
      calculateResults();
      document.getElementById('loadingScreen').classList.remove('show');
      showScreen('resultScreen');
    }, 2500);
  } else {
    // æ¬¡ã®ç‰©èªã®å‹•ç”»ã‚’å†ç”Ÿ
    setTimeout(() => {
      playStoryVideo();
    }, 300);
  }
}

function calculateResults() {
  const maxScore = Math.max(...Object.values(scores));
  const normalized = {};
  Object.keys(scores).forEach(p => {
    normalized[p] = maxScore > 0 ? Math.round((scores[p] / maxScore) * 100) : 0;
  });

  const maxPossible = STORIES.length * 6;
  const rawPercent = {};
  Object.keys(scores).forEach(p => {
    rawPercent[p] = Math.round((scores[p] / maxPossible) * 100);
  });

  const sorted = Object.entries(scores).sort((a, b) => b[1] - a[1]);
  const primary = sorted[0][0];
  const secondary = sorted[1][0];
  const typeCode = primary + '_' + secondary;
  const type = TYPES[typeCode] || TYPES['fire_wind'];

  renderResult(type, typeCode, primary, secondary, normalized, rawPercent, sorted);
}

function renderResult(type, typeCode, primary, secondary, normalized, rawPercent, sorted) {
  const content = document.getElementById('resultContent');
  content.scrollTop = 0;

  const radarSvg = createRadarChart(normalized);
  const typeImgSrc = typeImagePath(primary, secondary);

  content.innerHTML = `
    <div style="text-align:center;">
      <div class="result-type-image">
        <img src="${typeImgSrc}" alt="${type.nameJa}" onerror="this.style.display='none';">
      </div>
      <div class="result-header-icon">${type.icon}</div>
      <div class="result-label">ã‚ãªãŸã®ç‰©èªã¯</div>
      <div class="result-type-name">${type.nameJa}</div>
      <div class="result-type-en">${type.nameEn}</div>
      <div class="archetype-badge">${type.archetype}</div>
    </div>

    <div class="radar-container">${radarSvg}</div>

    <div class="score-section">
      <div class="score-section-title">ã‚ãªãŸã®é­‚ã®å½¢</div>
      ${Object.keys(PARAM_META).map(p => `
        <div class="score-item">
          <span class="score-icon">${PARAM_META[p].icon}</span>
          <span class="score-name">${PARAM_META[p].name}</span>
          <div class="score-bar-bg">
            <div class="score-bar-fill" style="background:${PARAM_META[p].color};" data-width="${normalized[p]}%"></div>
          </div>
          <span class="score-value">${rawPercent[p]}%</span>
        </div>
      `).join('')}
    </div>

    <div class="type-description">
      <div class="type-desc-text">${type.desc}</div>
      <div class="type-traits">
        <div>
          <div class="trait-group-title">âœ¦ å¼·ã¿</div>
          <div class="trait-tags">
            ${type.strengths.map(s => `<span class="trait-tag strength">${s}</span>`).join('')}
          </div>
        </div>
        <div>
          <div class="trait-group-title">âœ¦ æ³¨æ„ç‚¹</div>
          <div class="trait-tags">
            ${type.weaknesses.map(w => `<span class="trait-tag weakness">${w}</span>`).join('')}
          </div>
        </div>
      </div>
    </div>

    <div class="advice-section">
      <div class="advice-title">ğŸ¤– AIã¨ã®ä»˜ãåˆã„æ–¹</div>
      <div class="advice-text">${type.advice}</div>
    </div>

    <div class="share-section">
      <div class="share-card">
        <div class="share-card-title">é­‚ã®å›³æ›¸é¤¨</div>
        <div class="share-card-type">${type.icon} ${type.nameJa}</div>
        <div class="share-card-params">
          ${Object.keys(PARAM_META).map(p => `<span>${PARAM_META[p].icon}${rawPercent[p]}%</span>`).join('')}
        </div>
      </div>

      <button class="retry-btn" onclick="restart()">
        ã‚‚ã†ä¸€åº¦è¨ºæ–­ã™ã‚‹ ğŸ“–
      </button>
    </div>
  `;

  setTimeout(() => {
    content.querySelectorAll('.score-bar-fill').forEach(bar => {
      bar.style.width = bar.dataset.width;
    });
  }, 300);
}

function createRadarChart(normalized) {
  const params = ['fire', 'root', 'wind', 'water', 'light'];
  const cx = 180, cy = 170, r = 130;
  const angles = params.map((_, i) => (i * 2 * Math.PI / 5) - Math.PI / 2);

  let grid = '';
  [0.2, 0.4, 0.6, 0.8, 1.0].forEach(scale => {
    const points = angles.map(a =>
      `${cx + r * scale * Math.cos(a)},${cy + r * scale * Math.sin(a)}`
    ).join(' ');
    grid += `<polygon points="${points}" fill="none" stroke="rgba(201,168,76,${scale === 1 ? 0.25 : 0.12})" stroke-width="${scale === 1 ? 1.5 : 1}"/>`;
  });

  let axes = '';
  angles.forEach(a => {
    axes += `<line x1="${cx}" y1="${cy}" x2="${cx + r * Math.cos(a)}" y2="${cy + r * Math.sin(a)}" stroke="rgba(201,168,76,0.18)" stroke-width="1"/>`;
  });

  const dataPoints = params.map((p, i) => {
    const val = normalized[p] / 100;
    return `${cx + r * val * Math.cos(angles[i])},${cy + r * val * Math.sin(angles[i])}`;
  }).join(' ');

  let labels = '';
  params.forEach((p, i) => {
    const labelR = r + 32;
    const x = cx + labelR * Math.cos(angles[i]);
    const y = cy + labelR * Math.sin(angles[i]);
    labels += `<text x="${x}" y="${y - 8}" text-anchor="middle" dominant-baseline="central" font-family="'Kiwi Maru', serif" font-size="20">${PARAM_META[p].icon}</text>`;
    labels += `<text x="${x}" y="${y + 12}" text-anchor="middle" dominant-baseline="central" font-family="'Kiwi Maru', serif" font-size="13" fill="#6B5B4B">${PARAM_META[p].name}</text>`;
  });

  return `
    <svg viewBox="0 0 360 350" xmlns="http://www.w3.org/2000/svg">
      ${grid}
      ${axes}
      <polygon points="${dataPoints}" fill="rgba(201,168,76,0.18)" stroke="var(--gold)" stroke-width="2.5" stroke-linejoin="round">
        <animate attributeName="opacity" from="0" to="1" dur="1s" fill="freeze"/>
      </polygon>
      ${params.map((p, i) => {
        const val = normalized[p] / 100;
        const x = cx + r * val * Math.cos(angles[i]);
        const y = cy + r * val * Math.sin(angles[i]);
        return `<circle cx="${x}" cy="${y}" r="5" fill="${PARAM_META[p].color}" stroke="white" stroke-width="2.5">
          <animate attributeName="r" from="0" to="5" dur="0.8s" fill="freeze" begin="0.3s"/>
        </circle>`;
      }).join('')}
      ${labels}
    </svg>
  `;
}

function restart() {
  currentStory = 0;
  answers = [];
  scores = { fire: 0, root: 0, wind: 0, water: 0, light: 0 };
  showScreen('coverScreen');
  const cover = document.querySelector('.book-cover');
  cover.style.transition = 'none';
  cover.style.transform = '';
  cover.style.opacity = '';
  setTimeout(() => {
    cover.style.animation = 'bookFloat 4s ease-in-out infinite';
  }, 50);
}

// ===== åˆæœŸåŒ–: st00å†ç”Ÿ â†’ è¡¨ç´™è¡¨ç¤º =====
playIntroVideo();
</script>

</body>
</html>
